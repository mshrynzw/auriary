# テスト運用ガイドライン：リファレンス

## 16. テスト実行コマンド一覧

### 16.1 開発時

```bash
# 単体テストをウォッチモードで実行
pnpm test:unit:watch

# 結合テストを実行
pnpm test:integration

# E2Eテストを実行
pnpm test:e2e

# すべてのテストを実行
pnpm test
```

### 16.2 CI/CD時

```bash
# カバレッジレポートを生成
pnpm test:coverage

# リグレッションテストを実行
pnpm test:regression
```

### 16.3 特定のテストを実行

```bash
# 特定のファイルのみテスト
pnpm test:unit src/lib/validators/diary.test.ts

# 特定のテストスイートを実行
pnpm test:unit --testNamePattern="日記作成"

# カバレッジ付きで実行
pnpm test:unit --coverage
```

---

## 17. トラブルシューティング

### 17.1 テストが失敗する場合

1. **エラーメッセージを確認**
   - エラーメッセージを読んで原因を特定
   - スタックトレースを確認

2. **ログを確認**
   - テスト実行時のログを確認
   - デバッグモードで実行

3. **環境を確認**
   - テスト環境が正しく設定されているか確認
   - 環境変数が正しく設定されているか確認

4. **依存関係を確認**
   - 必要な依存関係がインストールされているか確認
   - バージョンの互換性を確認

### 17.2 テストが遅い場合

1. **並列実行を確認**
   - テストが並列実行されているか確認
   - 並列実行数を調整

2. **不要なテストを削除**
   - 不要になったテストを削除
   - 重複するテストを統合

3. **モックを活用**
   - 外部API呼び出しをモック化
   - データベースアクセスをモック化

4. **テストデータを最適化**
   - テストデータの量を削減
   - テストデータの生成を最適化

### 17.3 テストが不安定な場合

1. **タイミング問題を確認**
   - 適切な待機時間を設定
   - 非同期処理を適切に処理

2. **テストの独立性を確認**
   - テストが互いに独立しているか確認
   - テストの実行順序に依存していないか確認

3. **環境の一貫性を確認**
   - テスト環境が一貫しているか確認
   - ランダムな要素を排除

### 17.4 よくある問題と解決方法

#### 問題1: Supabase 接続エラー

```bash
# 解決方法: Supabase ローカル環境を起動
supabase start
```

#### 問題2: テストデータが残っている

```bash
# 解決方法: テストデータをクリーンアップ
supabase db reset
```

#### 問題3: 型エラー

```bash
# 解決方法: 型チェックを実行
pnpm type-check
```

---

**関連ドキュメント:**
- [概要](./401_Overview.md)
- [テスト実行タイミング](./405_Execution.md)
- [単体テスト戦略](../500_Unit_Test/Unit_Test_Strategy.md)
- [結合テスト戦略](../600_Integration_Test/Integration_Test_Strategy.md)
- [E2Eテスト戦略](../700_E2E_Test/E2E_Test_Strategy.md)

