# テスト運用ガイドライン：デグレ防止・優先順位

## 4. デグレ防止のためのルール

### 4.1 必須テスト

以下の機能には必ずテストを追加：

1. **認証機能**: ログイン、ログアウト、セッション管理
2. **日記CRUD**: 作成、取得、更新、削除
3. **RLS ポリシー**: ユーザーが他ユーザーのデータにアクセスできないこと
4. **バリデーション**: Zod スキーマの検証
5. **AI連携**: API呼び出しの前処理（後処理は結合テストで）

### 4.2 テストの必須条件

- **単体テスト**: 新規関数・ユーティリティには必ず追加
- **結合テスト**: 新規API Route Handler には必ず追加
- **E2Eテスト**: 新規ユーザーフローには必ず追加

### 4.3 リファクタリング時のルール

- リファクタリング前後でテスト結果が一致すること
- テストが失敗する場合は、リファクタリングを中断
- テストを修正する場合は、機能が変わっていないことを確認

---

## 8. テスト優先順位のガイドライン

### 8.1 必須テスト（P0）

以下の機能には必ずテストを追加：

1. **認証フロー**
   - ログイン
   - ログアウト
   - セッション管理

2. **日記CRUD**
   - 日記作成
   - 日記取得
   - 日記更新
   - 日記削除

3. **RLS ポリシー**
   - ユーザーが他ユーザーのデータにアクセスできないこと

### 8.2 重要テスト（P1）

以下の機能には優先的にテストを追加：

1. **カレンダー機能**
   - 日記一覧表示
   - フィルタリング

2. **AI連携**
   - 文章補完
   - 感情分析

### 8.3 推奨テスト（P2）

以下の機能には可能な限りテストを追加：

1. **UIコンポーネント**
   - 主要なコンポーネントの表示

2. **ユーティリティ関数**
   - 日付フォーマット
   - データ変換

---

**関連ドキュメント:**
- [概要](./401_Overview.md)
- [コミット・PR規約](./403_Commit_PR.md)
- [ブランチ戦略](./407_Branch.md)

