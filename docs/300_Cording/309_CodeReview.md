# コードレビュー方針

## コードレビュー方針

本ドキュメントは、auriary プロジェクトにおけるコードレビューの方針を定めたものです。

---

## コードレビューの目的

### 1. 品質保証

- バグの早期発見
- コード品質の向上
- セキュリティ問題の検出

### 2. 知識共有

- チームメンバー間の知識共有
- ベストプラクティスの共有
- コードベースの理解促進

### 3. 一貫性の維持

- コーディング規約の遵守
- プロジェクト全体の一貫性

---

## レビューのタイミング

### プルリクエスト時

- すべてのコード変更はプルリクエストを経る
- プルリクエストはレビューを必須とする
- 承認なしでマージしない

### レビューの優先度

- **高**: セキュリティ関連、データベース変更、認証関連
- **中**: 新機能追加、API変更
- **低**: ドキュメント更新、スタイル変更

---

## レビューチェックリスト

### 機能性

- [ ] 要件を満たしているか
- [ ] エッジケースを考慮しているか
- [ ] エラーハンドリングが適切か
- [ ] パフォーマンスに問題がないか

### コード品質

- [ ] コードが読みやすいか
- [ ] 命名が適切か
- [ ] 重複コードがないか
- [ ] 適切にコメントが書かれているか

### コーディング規約

- [ ] TypeScript の型が適切に使用されているか
- [ ] 命名規則に従っているか
- [ ] ファイル構造が適切か
- [ ] コミットメッセージが適切か

### セキュリティ

- [ ] 機密情報がハードコードされていないか
- [ ] 入力値のバリデーションが適切か
- [ ] SQLインジェクション対策がされているか
- [ ] XSS対策がされているか

### テスト

- [ ] テストが追加されているか（該当する場合）
- [ ] テストが適切に書かれているか
- [ ] テストが通過しているか

---

## レビューの実施方法

### レビュアーの選定

- 最低1名のレビュアーを必須とする
- セキュリティ関連は複数名でレビュー
- コードオーナーを優先的にレビュアーに選定

### レビューの時間

- プルリクエスト作成後24時間以内にレビュー開始
- 緊急の場合は優先的にレビュー

### レビューのコメント

- 建設的なフィードバックを提供
- 具体的な改善案を提示
- 承認・変更要求・コメントを明確に区別

---

## レビューコメントの書き方

### 良いレビューコメント

```markdown
# ✅ Good: 建設的なフィードバック

この関数は長すぎるので、以下のように分割することを提案します：
- `validateDiaryData()`: バリデーション処理
- `saveDiaryToDB()`: データベース保存処理

これにより、テストが容易になり、再利用性も向上します。
```

### 改善が必要なレビューコメント

```markdown
# ❌ Bad: 非建設的なコメント

このコードは良くない。

# ⚠️ Better: 改善案を提示

このコードは良くない。以下のように改善することを提案します：
- エラーハンドリングを追加
- 型定義を明確にする
```

---

## 承認基準

### 承認条件

1. **機能要件を満たしている**
   - 要件定義書に記載された機能が実装されている
   - エッジケースが適切に処理されている

2. **コード品質が高い**
   - コーディング規約に準拠している
   - 読みやすく、保守しやすいコード

3. **セキュリティ対策が適切**
   - セキュリティベストプラクティスに従っている
   - 機密情報が適切に保護されている

4. **テストが適切**
   - テストが追加されている（該当する場合）
   - テストが通過している

5. **ドキュメントが更新されている**
   - 必要に応じてドキュメントが更新されている
   - コメントが適切に記述されている

---

## 変更要求の対応

### 変更要求時の対応

1. **変更要求を確認**
   - レビュアーのコメントを理解する
   - 不明点があれば質問する

2. **変更を実装**
   - 変更要求に応じてコードを修正
   - 追加のコメントがあれば対応

3. **再レビューを依頼**
   - 変更後、再レビューを依頼
   - 変更内容を説明

---

## レビューのベストプラクティス

### レビュアー側

1. **建設的なフィードバック**
   - 批判ではなく、改善案を提示
   - 理由を明確に説明

2. **適切なタイミング**
   - レビューを遅延させない
   - 緊急度に応じて優先順位を付ける

3. **学習の機会**
   - レビューを通じて知識を共有
   - ベストプラクティスを伝える

### レビュー依頼者側

1. **明確な説明**
   - プルリクエストの説明を詳細に記述
   - 変更理由を明確にする

2. **小さな変更**
   - 大きな変更は分割する
   - レビューしやすいサイズにする

3. **フィードバックへの対応**
   - レビューコメントに適切に対応
   - 不明点があれば質問する

---

## 自動レビュー

### 自動チェック

- **ESLint**: コードスタイルのチェック
- **TypeScript**: 型チェック
- **Prettier**: コードフォーマット
- **テスト**: 自動テストの実行

### CI/CD でのチェック

```yaml
# GitHub Actions の例
- name: Lint
  run: npm run lint

- name: Type Check
  run: npm run type-check

- name: Test
  run: npm run test

- name: Build
  run: npm run build
```

---

## レビューの記録

### レビュー履歴

- プルリクエストにレビュー履歴が記録される
- 重要な決定事項はドキュメントに記録

### レビュー統計

- レビュー時間の記録
- レビューコメント数の記録
- 改善点の記録

---

**関連ドキュメント:**
- [コーディング規約（概要）](./301_CodingStandards.md)
- [Git コミット規約](./304_GitConventions.md)

