# 詳細設計書：画面一覧（UI設計）

## 3. 画面一覧（UI設計）

### 3.0 UI/UX設計原則

#### 3.0.1 ユーザーにやさしいUI・UX

**基本方針:**
- 直感的で分かりやすいインターフェース
- 一貫性のあるデザイン言語
- 適切なフィードバックとガイダンス
- アクセシビリティを考慮した設計

**実装方針:**
- shadcn/ui コンポーネントを活用した統一感のあるデザイン
- 適切な余白とタイポグラフィ
- 明確な視覚的階層
- エラーメッセージは分かりやすく、解決方法を提示

#### 3.0.2 ホバー時の説明表示（Popover）

**実装方式:**
- すべてのボタン・リンクにホバー時の説明文を表示
- shadcn/ui の `Popover` または `Tooltip` コンポーネントを使用
- アイコン付きボタンには必ず説明を付与

**コード例:**
```typescript
// src/components/ui/ButtonWithTooltip.tsx
import { Button } from '@/components/ui/button';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';

export function ButtonWithTooltip({
  children,
  tooltip,
  ...props
}: ButtonProps & { tooltip: string }) {
  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
          <Button {...props}>{children}</Button>
        </TooltipTrigger>
        <TooltipContent>
          <p>{tooltip}</p>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
}
```

**適用箇所:**
- すべてのアイコンボタン
- 主要なアクションボタン（保存、削除、編集など）
- ナビゲーションリンク
- フィルター・ソートボタン

#### 3.0.3 トースト通知によるフィードバック

**実装方式:**
- すべての操作（作成、更新、削除、エラー）に対してトースト通知を表示
- shadcn/ui の `Toast` コンポーネント（sonner）を使用
- 成功・失敗・警告・情報の4種類のトーストを用意

**トースト種別:**
- **成功（Success）**: 緑色、チェックアイコン
- **失敗（Error）**: 赤色、エラーアイコン
- **警告（Warning）**: 黄色、警告アイコン
- **情報（Info）**: 青色、情報アイコン

**コード例:**
```typescript
// src/lib/toast.ts
import { toast } from 'sonner';

export function showSuccessToast(message: string) {
  toast.success(message, {
    description: '操作が正常に完了しました',
  });
}

export function showErrorToast(message: string) {
  toast.error(message, {
    description: 'エラーが発生しました。もう一度お試しください',
  });
}
```

**適用箇所:**
- 日記作成・更新・削除
- 設定の保存
- エラー発生時
- データ同期完了時

#### 3.0.4 ヘッダーInfoアイコン

**実装方式:**
- すべての画面のヘッダー右上にInfoアイコンを配置
- クリックで各画面の説明を表示する `Dialog` を開く
- 画面ごとに適切な説明文を設定

**コード例:**
```typescript
// src/components/layout/Header.tsx
import { Info } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';

export function Header({ pageInfo }: { pageInfo: PageInfo }) {
  return (
    <header className="flex items-center justify-between p-4">
      <h1>{pageInfo.title}</h1>
      <Dialog>
        <DialogTrigger asChild>
          <Button variant="ghost" size="icon">
            <Info className="h-5 w-5" />
          </Button>
        </DialogTrigger>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>{pageInfo.title}について</DialogTitle>
          </DialogHeader>
          <div className="space-y-2">
            <p>{pageInfo.description}</p>
            <h4 className="font-semibold">主な機能:</h4>
            <ul className="list-disc list-inside space-y-1">
              {pageInfo.features.map((feature, i) => (
                <li key={i}>{feature}</li>
              ))}
            </ul>
          </div>
        </DialogContent>
      </Dialog>
    </header>
  );
}
```

**各画面の説明例:**
- **日記一覧画面**: 「日記一覧画面では、過去に作成した日記を一覧で確認できます。フィルターや検索機能を使って、目的の日記を素早く見つけることができます。」
- **日記編集画面**: 「日記編集画面では、新しい日記を作成したり、既存の日記を編集できます。AI補完機能を使って、文章作成をサポートします。」
- **カレンダー画面**: 「カレンダー画面では、日記をカレンダー形式で確認できます。月・週・日の3つのビューから選択できます。」

---

### 3.1 トップ画面

**URL:** `/`  
**概要:** アプリのランディングページ。認証状態に応じて表示を切り替え。

**使用コンポーネント:**
- `Card`, `CardHeader`, `CardTitle`, `CardContent`（shadcn/ui）
- `Button`（shadcn/ui）
- `Tooltip`（ボタンの説明表示）
- `Toast`（操作フィードバック）

**UI構成:**
- 認証済み：ユーザー情報表示 + ダッシュボードへの導線
- 未認証：ログイン・新規登録への導線
- ヘッダー：Infoアイコン（画面説明）

**UX配慮:**
- すべてのボタンにホバー時の説明を表示
- ログイン・登録成功時にトースト通知を表示

### 3.1.5 ダッシュボード画面

**URL:** `/dashboard`  
**概要:** ユーザーの日記データを統計情報とグラフで可視化。データの概要を一目で把握できる。

**使用コンポーネント:**
- `Card`, `CardHeader`, `CardTitle`, `CardContent`（統計情報カード）
- `ComposedChart`, `Line`, `Bar`（recharts）
- `Checkbox`, `Label`（表示項目の切り替え）
- `Select`, `SelectTrigger`, `SelectValue`, `SelectContent`, `SelectItem`（期間選択）
- `Button`（クイックアクション）
- `Link`（ナビゲーション）

**UI構成:**
- **ヘッダー**: タイトル「ダッシュボード」+ ユーザー名のウェルカムメッセージ
- **統計情報カード（4つ）**:
  - 総日記数
  - 今月の日記数
  - 平均感情スコア
  - 平均睡眠の質
- **統合グラフ**:
  - タイトル「データ推移」+ 期間選択ドロップダウン（右上）
  - ComposedChart（感情スコア・睡眠時間・7項目の気分・体調データ）
  - 表示項目のチェックボックス（グラフ下部）
- **最近の日記**: 最新5件の日記一覧
- **クイックアクション**: 新規作成、日記一覧、カレンダー、分析へのリンク

**機能:**
- **期間選択**: 全期間、過去1ヶ月、過去3ヶ月、過去6ヶ月、過去1年から選択可能
- **表示項目の切り替え**: 感情スコア、睡眠時間、睡眠の質、起床時の気分、日中の気分、就寝前の気分、服薬遵守度、食欲レベル、睡眠欲レベル、運動レベルの表示/非表示を切り替え可能
- **ローカルストレージ保存**: 期間選択と表示項目の設定をブラウザのローカルストレージに保存

**UX配慮:**
- デフォルト表示は感情スコアと睡眠時間のみ
- グラフのポイントはホバー時のみ表示
- 設定は次回アクセス時も維持される
- 期間選択によりグラフが自動更新される

### 3.2 日記一覧画面（将来実装）

**URL:** `/diary`  
**概要:** ユーザーの日記一覧を表示。フィルタリング・ソート機能付き。

**使用コンポーネント:**
- `Table`（日記一覧テーブル）
- `Card`（日記カード表示）
- `Select`（フィルタリング）
- `Pagination`（ページネーション）
- `Badge`（タグ表示）
- `Tooltip`（ボタン・リンクの説明表示）
- `Toast`（操作フィードバック）
- `Dialog`（Infoアイコンで表示する画面説明）

**UI構成:**
- ヘッダー：検索バー + フィルタ + 新規作成ボタン + Infoアイコン
- メイン：日記一覧（カード or テーブル）
- フッター：ページネーション

**UX配慮:**
- すべてのボタン・リンクにホバー時の説明を表示
- 日記削除時に確認ダイアログとトースト通知を表示
- フィルター適用時にトーストで通知

### 3.3 日記詳細画面（将来実装）

**URL:** `/diary/[id]`  
**概要:** 個別の日記を表示。編集・削除機能。

**使用コンポーネント:**
- `Card`（日記コンテンツ）
- `Button`（編集・削除）
- `Badge`（タグ・感情スコア）
- `Calendar`（日付表示）
- `Tooltip`（ボタンの説明表示）
- `Toast`（操作フィードバック）
- `Dialog`（Infoアイコンで表示する画面説明、削除確認）

**UI構成:**
- ヘッダー：日付 + アクションボタン + Infoアイコン
- メイン：日記本文（Markdown レンダリング）
- サイドバー：タグ・感情スコア・AI 分析結果

**UX配慮:**
- 編集・削除ボタンにホバー時の説明を表示
- 削除時に確認ダイアログを表示
- 削除成功時にトースト通知を表示

### 3.4 日記編集画面

**URL:** `/diary/[id]/edit` または `/diary/new`  
**概要:** 日記を作成・編集。気分・体調の記録、時刻記録、OD記録機能を含む。

**使用コンポーネント:**
- `Textarea`（本文入力）
- `Input`（日付、時刻入力）
- `Button`（保存・キャンセル、OD記録追加・削除）
- `Dialog`（Infoアイコンで表示する画面説明）
- `Slider`（気分・体調レベル入力）
- `Checkbox`（OD発生フラグ）
- `Select`（薬選択）
- `Tooltip`（ボタン・入力フィールドの説明表示）
- `Toast`（操作フィードバック）

**UI構成:**
- ヘッダー：画面タイトル
- メイン：
  - 日付入力
  - 日記本文入力（Textarea）
  - 気分・体調セクション（スライダー入力）
    - 睡眠の質、起床時の気分、日中の気分、就寝前の気分
    - 服薬遵守度、食欲レベル、睡眠欲レベル、運動レベル
  - 時刻記録セクション
    - 起床時刻、就寝時刻
    - 入浴開始時刻、入浴終了時刻
  - OD記録セクション
    - OD発生チェックボックス
    - OD情報入力UI（OD発生ON時のみ表示）
      - 「追加」ボタンでOD記録を追加
      - 各OD記録：
        - 発生日時（datetime-local）
        - 薬（Select：薬マスタから選択、または自由入力）
        - 量（数値入力）+ 単位（テキスト入力）
        - 状況メモ（Textarea）
        - 「削除」ボタンで削除
- フッター：キャンセルボタン + 保存ボタン

**OD記録機能の詳細:**
- OD発生チェックボックスをONにすると、OD情報入力UIが表示
- 「追加」ボタンで複数のOD記録を追加可能
- 各OD記録は独立したカードとして表示
- 薬マスタから選択するか、自由入力で薬名を入力可能
- 最後のOD記録を削除すると、OD発生チェックボックスも自動的にOFF

**UX配慮:**
- すべてのボタン・入力フィールドにホバー時の説明を表示
- 保存成功・失敗時にトースト通知を表示
- OD発生チェックボックスON時に自動的に初期OD記録を追加
- 薬マスタから選択した場合、薬名が自動入力される

### 3.5 カレンダー画面（将来実装）

**URL:** `/calendar`  
**概要:** カレンダービューで日記を表示。月/週/日ビュー切替。

**使用コンポーネント:**
- `Calendar`（shadcn/ui）
- `Tabs`（ビュー切替）
- `Badge`（日記有無表示）
- `Tooltip`（ボタン・タブの説明表示）
- `Toast`（操作フィードバック）
- `Dialog`（Infoアイコンで表示する画面説明）

**UI構成:**
- ヘッダー：ビュー切替タブ + フィルタ + Infoアイコン
- メイン：カレンダー表示
- サイドバー：選択日の日記プレビュー

**UX配慮:**
- ビュー切替タブにホバー時の説明を表示
- カレンダーの日付にホバー時に日記の有無を表示
- フィルター適用時にトースト通知を表示

### 3.6 分析画面（将来実装）

**URL:** `/analytics`  
**概要:** 感情分析・トピック分析の可視化。

**使用コンポーネント:**
- `Chart`（recharts 統合）
- `Card`（統計情報）
- `Tabs`（分析種別切替）
- `Tooltip`（グラフ要素・タブの説明表示）
- `Dialog`（Infoアイコンで表示する画面説明）

**UI構成:**
- ヘッダー：分析種別切替タブ + Infoアイコン
- メイン：感情シーケンスグラフ（過去30日間）、トピック分布（円グラフ）、統計サマリー（カード表示）

**UX配慮:**
- グラフの各要素にホバー時に詳細情報を表示
- タブ切替時にスムーズなアニメーション
- データ読み込み中はスケルトン表示

### 3.7 設定画面（将来実装）

**URL:** `/settings`  
**概要:** ユーザー設定・アカウント管理。

**使用コンポーネント:**
- `Form`（設定フォーム）
- `Switch`（トグル設定）
- `Input`（プロフィール編集）
- `Button`（保存・ログアウト）
- `Tooltip`（設定項目・ボタンの説明表示）
- `Toast`（操作フィードバック）
- `Dialog`（Infoアイコンで表示する画面説明、アカウント削除確認）

**UI構成:**
- ヘッダー：設定タイトル + Infoアイコン
- メイン：プロフィール設定、通知設定、AI 設定（補完レベルなど）、アカウント削除

**UX配慮:**
- すべての設定項目にホバー時の説明を表示
- 設定保存成功・失敗時にトースト通知を表示
- アカウント削除時に確認ダイアログを表示
- ログアウト成功時にトースト通知を表示

### 3.8 通知一覧画面（将来実装）

**URL:** `/notifications`  
**概要:** アプリ内通知の一覧を表示。未読/既読のフィルタリング、既読更新機能。

**使用コンポーネント:**
- `Card`（通知カード）
- `Badge`（未読バッジ）
- `Button`（既読更新、すべて既読）
- `Tabs`（未読/すべての切替）
- `Tooltip`（ボタンの説明表示）
- `Toast`（操作フィードバック）
- `Dialog`（Infoアイコンで表示する画面説明）

**UI構成:**
- ヘッダー：未読件数表示 + すべて既読ボタン + Infoアイコン
- メイン：通知一覧（時系列順）
- 各通知カード：タイトル、メッセージ、日時、リンクボタン

**UX配慮:**
- すべて既読ボタンにホバー時の説明を表示
- 既読更新成功時にトースト通知を表示
- 通知カードにホバー時に詳細情報を表示

### 3.9 通知設定画面（将来実装）

**URL:** `/settings/notifications`  
**概要:** 通知設定を変更。プッシュ通知・メール通知の有効/無効、通知種別ごとの設定。

**使用コンポーネント:**
- `Switch`（通知のON/OFF）
- `Select`（リマインダー時刻選択）
- `Input`（日記未記入リマインダー日数）
- `Button`（保存）
- `Tooltip`（設定項目の説明表示）
- `Toast`（操作フィードバック）
- `Dialog`（Infoアイコンで表示する画面説明）

**UI構成:**
- ヘッダー：通知設定タイトル + Infoアイコン
- メイン：
  - プッシュ通知セクション
    - プッシュ通知の有効/無効
    - 日記リマインダー（プッシュ）のON/OFF
    - 日記未記入リマインダー（プッシュ）のON/OFF
    - AI分析完了通知（プッシュ）のON/OFF
  - メール通知セクション
    - メール通知の有効/無効
    - 日記リマインダー（メール）のON/OFF
    - 日記未記入リマインダー（メール）のON/OFF
    - 週次サマリー（メール）のON/OFF
  - リマインダー設定セクション
    - 日記リマインダー時刻（時刻選択）
    - 日記未記入リマインダー日数（1-30日）

**UX配慮:**
- すべての設定項目にホバー時の説明を表示
- 設定保存成功・失敗時にトースト通知を表示
- プッシュ通知の有効化時にブラウザの許可を促す説明を表示

---

**関連ドキュメント:**
- [基本設計書](./100_BasicDesign.md)
- [コンポーネント設計](./207_DetailedDesign_Components.md)

